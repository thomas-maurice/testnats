<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>glua + NATS â€” Lua Playground</title>
</head>
<body>
<div id="app">
  <header>
    <h1>glua + NATS</h1>
    <span class="tag">Lua Playground</span>
    <span class="spacer"></span>
    <span class="arch">
      <span>Vue.js</span> &rarr; Go API &rarr; <span>NATS</span> &rarr; <span>glua</span> (ConnectRPC)
    </span>
  </header>

  <div class="main">
    <div class="sidebar">
      <h2>Examples</h2>
      <div
        v-for="(ex, i) in examples"
        :key="i"
        class="example"
        :class="{ active: activeExample === i }"
        @click="loadExample(i)"
      >{{ ex.name }}</div>
    </div>

    <div class="editor-area">
      <div class="toolbar">
        <button
          class="btn-run"
          :class="{ running }"
          :disabled="running || !script.trim()"
          @click="execute"
        >{{ running ? 'Running...' : '&#9654; Run' }}</button>
        <span class="status" v-if="lastTime !== null">
          Executed in <span class="time">{{ lastTime }}ms</span>
        </span>
        <span class="status" v-if="!running && lastTime === null">
          Ctrl+Enter to run
        </span>
      </div>

      <div class="panes" :class="{ dragging }">
        <div class="pane" :style="{ flex: '0 0 ' + editorWidth + '%' }">
          <div class="pane-header">Script</div>
          <div class="code-wrap">
            <pre><code class="language-lua" v-html="highlighted"></code></pre>
            <textarea
              v-model="script"
              @keydown.ctrl.enter.prevent="execute"
              @keydown.meta.enter.prevent="execute"
              @scroll="syncScroll"
              ref="codeTextarea"
              spellcheck="false"
              placeholder="-- Write your Lua script here..."
            ></textarea>
          </div>
          <div class="vars-section">
            <div class="vars-header" @click="showVars = !showVars">
              <span class="arrow">{{ showVars ? '&#9660;' : '&#9654;' }}</span>
              Variables ({{ variables.length }})
            </div>
            <div class="vars-body" v-show="showVars">
              <div class="var-row" v-for="(v, i) in variables" :key="i">
                <input class="key" v-model="v.key" placeholder="name" />
                <input class="val" v-model="v.value" placeholder="value" />
                <button class="btn-remove" @click="variables.splice(i, 1)">&times;</button>
              </div>
              <button class="btn-add-var" @click="variables.push({ key: '', value: '' })">+ Add variable</button>
            </div>
          </div>
        </div>

        <div class="drag-handle" @mousedown.prevent="startDrag" @touchstart.prevent="startDrag"></div>

        <div class="pane">
          <div class="pane-header">
            <span
              class="indicator"
              :class="{ ok: output && !output.error, err: output && output.error }"
            ></span>
            Output
          </div>
          <div class="output">
            <div v-if="!output" class="empty">Output will appear here after execution.</div>
            <template v-else>
              <div v-for="(line, i) in output.logs" :key="i" class="log-line preformatted">{{ line }}</div>
              <div v-if="output.result" class="result-block">
                <div class="result-label">Result</div>
                <div class="preformatted">{{ output.result }}</div>
              </div>
              <div v-if="output.error" class="error-block">
                <div class="error-label">Error</div>
                <div class="preformatted">{{ output.error }}</div>
              </div>
            </template>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script type="module" src="/src/main.js"></script>
</body>
</html>
